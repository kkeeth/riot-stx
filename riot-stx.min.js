riotStx={useStxLocalToInitGlobalStx:!1,create(...t){riotStx.installState(...t),riot.install(function(t){riotStx.installRiotPlugin(t)})},installState(...t){stx=new Proxy({},{set:function(t,e,n){return"_"!=e[0]&&JSON.stringify(t[e]||null)!==JSON.stringify(n)&&(t[e]=n,window.dispatchEvent(new CustomEvent("stx_"+e,{detail:{key:e,value:n}}))),!0}}),t.forEach(t=>{riotStx.deepExtend(stx,stx,t)})},installRiotPlugin(t){const{onBeforeMount:e,onMounted:n,onBeforeUpdate:o,onUpdated:i,onBeforeUnmount:s,onUnmounted:r}=t;t.updateState=function(e){t.stx[e.detail.key]=e.detail.value,t.update()},t.stx=new Proxy(t.stx||{},{set:function(t,e,n){return"_"!=e[0]&&JSON.stringify(t[e])!==JSON.stringify(n)?(t[e]=n,stx[e]=n):t[e]=n,!0}}),t.onBeforeMount=function(...n){for(let[e,n]of Object.entries(t.stx))"_"!=e[0]&&(void 0!==stx[e]?t.stx[e]=stx[e]:riotStx.useStxLocalToInitGlobalStx&&(stx[e]=t.stx[e]),window.addEventListener("stx_"+e,t.updateState));e&&e.apply(this,n)},t.onUnmounted=function(...e){for(let[e,n]of Object.entries(t.stx))"_"!=e[0]&&window.removeEventListener("stx_"+e,t.updateState);r&&r.apply(this,e)},t.setState=function(t){riotStx.setState(t)},t.setOneState=function(t){riotStx.setState(t)}},setOneState(t,e){stx[t]=e},setState(t){riotStx.deepExtend(stx,stx,t)},deepExtend(t){t=t||{};for(var e=1;e<arguments.length;e++){var n=arguments[e];if(n)for(var o in n)n.hasOwnProperty(o)&&("object"==typeof n[o]?n[o]instanceof Array==1?t[o]=n[o].slice(0):t[o]=riotStx.deepExtend(t[o],n[o]):t[o]=n[o])}return t}};
