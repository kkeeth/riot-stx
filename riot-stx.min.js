riotStx={useStxLocalToInitGlobalStx:!1,create(...t){riotStx.installState(t),riot.install(function(t){riotStx.installRiotPlugin(t)})},installState(t){state=new Proxy({},{set:function(t,e,n){return"_"!=e[0]&&JSON.stringify(t[e]||null)!==JSON.stringify(n)&&(t[e]=n,window.dispatchEvent(new CustomEvent("state_"+e,{detail:{key:e,value:n}}))),!0}}),t.forEach(t=>{riotStx.deepExtend(state,state,t)})},installRiotPlugin(t){const{onBeforeMount:e,onMounted:n,onBeforeUpdate:o,onUpdated:a,onBeforeUnmount:i,onUnmounted:s}=t;t.updateState=function(e){t.stx[e.detail.key]=e.detail.value,t.update()},t.stx=new Proxy(t.stx||{},{set:function(t,e,n){return"_"!=e[0]&&JSON.stringify(t[e])!==JSON.stringify(n)?(t[e]=n,state[e]=n):t[e]=n,!0}}),t.onBeforeMount=function(...n){for(let[e,n]of Object.entries(t.stx))"_"!=e[0]&&(void 0!==state[e]?t.stx[e]=state[e]:riotStx.useStxLocalToInitGlobalStx&&(state[e]=t.stx[e]),window.addEventListener("state_"+e,t.updateState));e&&e.apply(this,n)},t.onUnmounted=function(...e){for(let[e,n]of Object.entries(t.stx))"_"!=e[0]&&window.removeEventListener("state_"+e,t.updateState);s&&s.apply(this,e)},t.setState=function(t){riotStx.setState(t)},t.setOneState=function(t){riotStx.setState(t)}},setOneState(t,e){state[t]=e},setState(t){riotStx.deepExtend(state,state,t)},subscribe(t,e){window.addEventListener("state_"+t,t=>{e(t.detail)})},deepExtend(t){t=t||{};for(var e=1;e<arguments.length;e++){var n=arguments[e];if(n)for(var o in n)n.hasOwnProperty(o)&&("object"==typeof n[o]?n[o]instanceof Array==1?t[o]=n[o].slice(0):t[o]=riotStx.deepExtend(t[o],n[o]):t[o]=n[o])}return t}};
